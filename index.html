
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Scribblings</title>
  <meta name="author" content="Sunil Kumar">

  
  <meta name="description" content="People familiar with developing Ios applications with Objective-C would be quite familiar with using categories I suppose. An Objective-C category &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tech.sunilnkumar.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Scribblings" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    >
  <header role="banner"><hgroup>
  <h1><a href="/">Scribblings</a></h1>
  
    <h2>Scribbling down experiences.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tech.sunilnkumar.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="http://www.sunilnkumar.com/">Home</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/27/objective-c-categories-into-rubymotion">Objective-C Categories Into Rubymotion</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-27T14:04:00+05:30" pubdate data-updated="true">Feb 27<span>th</span>, 2014</time>
        
         | <a href="/2014/02/27/objective-c-categories-into-rubymotion#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>People familiar with developing Ios applications with Objective-C would be quite familiar with using <strong>categories</strong> I suppose.</p>

<p>An Objective-C category allows you to add methods to an existing class â€” effectively subclassing it without having to deal with the possible complexities of subclassing.</p>

<p>Moving into Rubymotion and using the power of categories is quite well possible for people who have been working with Ruby. <strong>Monkey Patching</strong> ( open an existing class and add your custom code within it ) it quite a familiar task with Rubyists.</p>

<p>Below is an example where I need to add a customized back button for the UINavigationController navigation bar. I need this to be the back button in quite a few View controllers. It would be quite a tedious task to create a button in each VC, hence I create a category file and monkey patch the UIBarButtonItem class to add a new method which returns the customized back button.</p>

<p><em>app/categories/ui_bar_button_item.rb</em></p>

<pre><code>def self.customBackButton(target, action)
  buttonImage = UIImage.imageNamed('arrow.jpeg')
  button = UIButton.buttonWithType(UIButtonTypeCustom)
  button.setImage(buttonImage, forState:UIControlStateNormal)
  button.frame = CGRectMake(0, 0, buttonImage.size.width, buttonImage.size.height)
  button.addTarget(target, action:action, forControlEvents:UIControlEventTouchUpInside)
  customBarItem = UIBarButtonItem.alloc.initWithCustomView(button)
  customBarItem
end
</code></pre>

<p>The view controller which needs to have this customized back button will have this</p>

<pre><code>def viewDidAppear(animated)
  super
  self.navigationItem.leftBarButtonItem = UIBarButtonItem.customBackButton(self.navigationController, 'popViewControllerAnimated:')
end
</code></pre>

<p>This would use Ruby&rsquo;s monkey patching power to create elements in Rubymotion which could be used in the entire application as &amp; when needed.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/02/06/rubymotion-chain-of-modal-segues">Rubymotion: Chain of Modal Segues</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-06T19:02:00+05:30" pubdate data-updated="true">Feb 6<span>th</span>, 2014</time>
        
         | <a href="/2014/02/06/rubymotion-chain-of-modal-segues#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While building my iOS application, I had a user registration process to be implemented. This included the user entering his mobile number, his language details and a few other ( say, miscellaneous ) details. Once he has registered himself he is presented with a table view where a few movies in the language he chose are shown.</p>

<p>The way I went about implementing is that I had a <strong>master_view_controller</strong> which is the initial view controller. The other controllers are</p>

<ul>
<li><strong>mobile_number_view_controller</strong></li>
<li><strong>language_view_controller</strong></li>
<li><strong>miscellaneous_view_controller</strong></li>
<li><strong>movies_view_controller</strong></li>
</ul>


<p>I have segues, <strong>all of type modal</strong>, from the master controller to all other controllers I mentioned above. The segues are of modal type because once the user has submitted each of his details, he doesnt have to care about the particluar detail and is given no option to go back to his previous screen. Its not a like a dig deep type of chain where we could implement the navigation controller. The segues are the follows.</p>

<p>On the left we have the contoller and on the right we have the segue identifier to that controller from the master controller.</p>

<pre><code>master_view_controller:
  mobile_number_view_controller -&gt; msisdnSegue
  language_view_controller -&gt; languageSegue
  miscellaneous_view_controller -&gt; miscellaneousSegue
  movies_view_controller -&gt; moviesSegue
</code></pre>

<p>Also, we have this chain of modal segues.</p>

<pre><code>master_view_controller -&gt; mobile_number_view_controller -&gt; language_view_controller -&gt; miscellaneous_view_controller
</code></pre>

<p>Now in the viewDidAppear delegate of the master controller, we have this check to present the appropriate controller. The details entered by the user in the registration process are saved( we use <strong>motion model</strong> to store the details of the user ). Ofcourse, we dont want a user who has entered his mobile number once to enter it again even if he has opted to quit the app after entering the mobile number. Similarly we dont want him to select his language for the second time during the registration process. We consider all this in the viewDidAppear delegate and decide which contoller to load.</p>

<p>master_view_controller.rb ( This obviously can be implemented better :) )</p>

<pre><code>def viewDidAppear(animated)
  super
  perform_criteria_based_segue
end

def perform_criteria_based_segue
  @user = User.first

  if (not @user) or (not @user.verified_mobile_number)
    performSegueWithIdentifier('msisdnSegue', sender: self)
  end

  elsif not @user.language
    performSegueWithIdentifier('languageSegue', sender: self)
  end

  elsif not @user.miscellaneous_details
    performSegueWithIdentifier('miscellaneousSegue', sender: self)
  end

  else
    performSegueWithIdentifier('moviesSegue', sender: self)
  end
end
</code></pre>

<p>Now, suppose the user reached the view where he has to enter his misellaneous details. Once he entered them all he now has to be be shown the table view which list the movies in his language. We have implemented this segue to the movies_view_controller in <strong>viewDidAppear</strong> delegate in the <strong>master_view_controller</strong>. Hence for this to work, the master_view_controller&rsquo;s view will have to appear. For this to happen, the current controller( the i.e, <strong>miscellaneous_view_controller</strong> ) along with all controllers in between the current controller and the master view controller will have to be dismissed ( in our case, its only the <strong>language_view_controller</strong> ).</p>

<p>For this to be done, we have the <strong>dismissViewControllerAnimated(flag, completion:completion_block)</strong> method.</p>

<p>We implement this method in the presented view controller. Here, <strong>miscellaneous_view_controller</strong> is the current presented view controller.</p>

<p>miscellaneous_view_controller.rb</p>

<pre><code>outlet :submitButton, UIButton
ib_action :submit_miscellanous_details

def submit_miscellanous_details
  # Do something here...

  self.view.window.rootViewController.dismissViewControllerAnimated(true, completion:nil)
end
</code></pre>

<p>So in the <strong>miscellaneous_view_controller</strong> controller we have a <em>submitButton</em> which is tied to an ib_action <em>submit_miscellanous_details</em>. On submitting the button, the ib_action is invoked. We do whatever necessary steps is required in the ib_action and then <strong>invoke dismissViewControllerAnimated on the rootViewController( i.e, the master_view_controller )</strong>. When this is done, the presented controllers and all other controllers in the chain of controllers until the presenting controller on whom the dismissViewControllerAnimated method is called ( here, the rootViewController) is also dismissed. The rootViewController or the master_view_controller view appears on screen and the viewDiDAppear delegate will process the rest.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/01/24/rubymotion-using-progresshud-while-making-http-calls">Rubymotion: Using ProgressHud While Making Http Calls</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-24T20:04:00+05:30" pubdate data-updated="true">Jan 24<span>th</span>, 2014</time>
        
         | <a href="/2014/01/24/rubymotion-using-progresshud-while-making-http-calls#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With Rubymotion, there are quite a few methods to indicate activities. What I have used here is the MBProgressBarHud to indicate an ongoing activity ( an http call in progress )</p>

<h4>controller/msisdn_view_controller.rb</h4>

<pre><code>outlet :submitButton, UIButton
ib_action :submit_mobile_number  #The submit button on event â€˜Touch Up Insideâ€™ invokes the action submit_mobile_number

def viewDidLoad
  @hud = MBProgressHUD.alloc.initWithWindow(UIApplication.sharedApplication.keyWindow)
  self.view.addSubview(@hud)
end

def submit_mobile_number(sender)
  msisdn = self.msisdnTextField.text
  prepare_for_submission
  User.registration msisdn, do
    after_submission
  end
end

def prepare_for_submission
  @hud.labelText = "Provisioning"
  @hud.show(true)
  self.view.userInteractionEnabled = false
end

def after_submission
  @hud.labelText = "Completed";
  @hud.hide(true)
  performSegueWithIdentifier('submission_segue', sender: self)
end
</code></pre>

<h4>models/user.rb</h4>

<pre><code>def self.registration(msisdn, &amp;callback)
  ...
  url = 'some_url'
  BW::HTTP.get(url) do |response|
    callback.call
    ...
  end
end
</code></pre>

<p>As you could see from the code above, in the viewDidLoad delegate we initiate an MBProgressHUD instance and add it as a subview to the UIView. This is done in the viewDidLoad delegate.</p>

<p>Before the call to <strong>registration</strong> ( the User model method which makes an http connection ) is made, the <strong>prepare_for_submission</strong> method displays the hud. The <strong>after_submission</strong> method is passed as a callback block to the <strong>registration</strong> method. On completion of the http request, this block is executed which hides the hud and performs the segue to present the next controller.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/12/18/heroku-deployment-with-mongodb-database">Heroku Deployment With MongoDB Database</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-18T19:01:00+05:30" pubdate data-updated="true">Dec 18<span>th</span>, 2013</time>
        
         | <a href="/2013/12/18/heroku-deployment-with-mongodb-database#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Currently, I develop a Rails app with <a href="http://www.mongodb.org/">mongodb</a> as the database.
When I decided to deploy this in heroku, as per the heroku dev doc, I was asked to simply install the MongoHQ Add-on, and specify the plan that I desire.</p>

<p>So, supposedly all I had to do was this,</p>

<div>
  <pre><code class='bash'>heroku addons:add mongohq:small</code></pre>
</div>


<p>and I would have the MONGOHQ_URL to add to the mongoid configuration ( config/mongoid.yml ).
But unfortunately, this would ask me to verify my heroku account</p>

<div>
  <pre><code class='bash'>Adding mongolab on chillrapi... failed
 !    Please verify your account to install this add-on
 !    For more information, see http://devcenter.heroku.com/categories/billing
 !    Verify now at https://heroku.com/verify</code></pre>
</div>


<p>Clicking on the verification link asks for my credit card details. Now, its mentioned that mongohq-small is a free version of the add on. So you could probably carry on providing your details. For the others, you may please read on.</p>

<p>MongoHQ is a cloud-based hosted database solution that allows developers to easily deploy, manage and scale both single and replica set MongoDB databases for their web and mobile applications.</p>

<p>I created a new database (SandBox, 512 MB &ndash;  thats all I needed anyways ) at MongoHQ.
On creating a new database, MongoHQ provides us with a mongo console and mongo uri connection strings.</p>

<p><strong>Mongo Console</strong></p>

<div>
  <pre><code class='bash'>mongo paulo.mongohq.com:10097/chillr_db -u &lt;user&gt; -p&lt;password&gt;</code></pre>
</div>


<p><strong>Mongo URI</strong></p>

<div>
  <pre><code class='bash'>mongodb://&lt;user&gt;:&lt;password&gt;@paulo.mongohq.com:10097/chillr_db</code></pre>
</div>


<p>Now, add a database user with a username, password. Check <a href="http://support.mongohq.com/common-questions/debugging-connection-issues.html">mongohq support docs</a> for reference.</p>

<p>You could try out the mongo console connection string from your local to check if the user credentials are valid. Once you find them valid, add the MONGOHQ_URL to the heroku config set.</p>

<div>
  <pre><code class='bash'>heroku config:set MONGOHQ_URL=&quot;mongodb://&lt;user&gt;:&lt;password&gt;@paulo.mongohq.com:10097/chillr_db&quot;</code></pre>
</div>


<p>Be sure to replace the username and password while adding.
Thats it, Mongodb hosted in MongoHQ should be now available for use in the application.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/09/01/migrating-from-wordpress-to-jekyll-in-ten-steps">Migrating From Wordpress to Jekyll in Ten Steps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-01T13:32:26+05:30" pubdate data-updated="true">Sep 1<span>st</span>, 2013</time>
        
         | <a href="/2013/09/01/migrating-from-wordpress-to-jekyll-in-ten-steps#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Migrating from Wordpress to <a href="http://jekyllrb.com/">Jekyll</a> is not at all a fussy process. Here, I will state down the 10 steps on how I moved my blog from Wordpress to github pages using jekyll.  It would be really good if you could just have a walk through jekyll&rsquo;s home pages to get an idea of the prerequisities and workings.</p>

<p>1) Export your blog from Wordpress and download the exported xml thats generated by Wordpress. Use xmllint for xml validation and correct any errors that might be there.</p>

<p>2) Jekyll provides with enough options to migrate from a different blogging system. What I used for the process was the tool, <a href="https://github.com/thomasf/exitwp">exitwp</a> by <a href="http://thomas.jossystem.se/">thomasf</a>. Followed the instructions in the README and this worked like a charm .</p>

<p>  If followed properly, the &lsquo;build&rsquo; directory will have the posts converted into markdown format which is required by jekyll.</p>

<p>3) Install the jekyll gem,</p>

<div>
  <pre><code class='bash'>$: gem install jekyll</code></pre>
</div>


<p>4) Now initialize your new blog</p>

<div>
  <pre><code class='bash'>$: jekyll new techblog</code></pre>
</div>


<p>cd into the techblog directory and you could see the directory structure there.</p>

<div>
  <pre><code class='bash'>_posts
_layouts
css
_config.yml
index.html</code></pre>
</div>


<p>This is the minimum directory structure that jenkyll requires inorder to work as a fully functional website. How cool, right?
Now all you need is to copy all the posts from the <code>&lsquo;build/jekyll/username.wordpress.com/<em>posts&rsquo;</code> directory of the exitwp tool to the </em>posts directory of your new &lsquo;techblog&rsquo;. Also you may want to add your own configurations in the config file (specially, the <a href="http://jekyllrb.com/docs/permalinks/">permalink</a> option)</p>

<p>5) Once you have done this, its time to view the website in our local machine. To do this run,</p>

<div>
  <pre><code class='bash'>$: jekyll serve -w   # -w, watch so that your changes are automatically reloaded</code></pre>
</div>


<p><code> <a href="http://localhost:4000">http://localhost:4000</a> </code> and you could view your minimalistic static website.</p>

<p>6) Now to host your website on <a href="http://pages.github.com/">github pages</a>, there are some special rules to be followed. The repo you create in github must be of the name, <strong>username.github.io</strong> and there fore in my case it was sunilkumarn.github.io . Create this repo in your github account and set the giturl in your local &lsquo;techblog&rsquo; directory.</p>

<p>7) Push your commits to github.</p>

<p>8) Check your mail to see if there are any build failure mails from github. If no, all is hunky dorry. Wait for something like 5 -10 minutes and type <code>&lsquo;<a href="http://username.github.io">http://username.github.io</a>&rsquo;</code> in your browser. You should see your website, Yeeyy!</p>

<p>9) To point a domain to your website, check <a href="https://help.github.com/articles/setting-up-a-custom-domain-with-pages">github pages help</a>. For me, I pointed a subdomain to my new blog.</p>

<ul>

<li>Github pages will mention the IP hosted. Point the A record of your domain to the mentioned IP from your domain registrar.</li>

<li>Also, add a new file CNAME to the root of your &#8216;techblog&#8217; directory. The file has a line containing your domain name, thats it.</li>
    eg, tech.sunilnkumar.com
</ul>


<p>10) Push your changes to github and wait for some time (cannot provide a good estimate). Your domain will be pointed to your new website hosted on github pages via jekyll. Also please do not forget to check if issues like broken urls, formatting issues, code highlightings etc etc exists. If yes, you might need to invest a bit more of your time to fix these as I had to.</p>

<p>The source of my website can be found <a href="https://github.com/sunilkumarn/sunilkumarn.github.io">here</a></p>

<p>Happy migrating :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/07/node-js-event-emitters-and-listeners">Node.js: Event Emitters and Listeners</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-07T13:32:26+05:30" pubdate data-updated="true">Jul 7<span>th</span>, 2013</time>
        
         | <a href="/2013/07/07/node-js-event-emitters-and-listeners#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When building client side applications with Javascript, events and handling them are quite common. Consider, for example,</p>

<div>
  <pre><code class='javascript'>$('#toBeClicked').on('click', function() { alert('clicked') })</code></pre>
</div>


<p>Here we handle a <em>click event</em> on the element with id &lsquo;toBeClicked&rsquo;. When the element is clicked, a &lsquo;click&rsquo; event is emitted which is handled by the above statement written by us.</p>

<p>Just like in the DOM, Â many objects in node emit events. When they do so, they inherit from the <strong>EventEmitter</strong> constructor.</p>

<p>Lets straight away build a custom event emitter and see whats going on,</p>

<div>
  <pre><code class='javascript'>EventEmitter = require('events').EventEmitter Â  Â  Â  // The Event Emitter constructor in the events.js module .</code></pre>
</div>


<p>Now, we create our custom emitter which is an instance of EventEmitter,</p>

<div>
  <pre><code class='javascript'>emitter = new EventEmitter();</code></pre>
</div>


<p>We listen for the error event,</p>

<div>
  <pre><code class='javascript'>emitter.on('error', function(msg1, msg2) { console.log('ERR: ' + msg1 + ' ' + msg2 ) })</code></pre>
</div>


<p>Here, <code>function(msg1, msg2) { console.log('ERR' + msg1 + ' ' + msg2 ) }</code></p>

<p>is the callback to be performed once the event is emitted,</p>

<p>We could also listen as,</p>

<div>
  <pre><code class='javascript'>emitter.addListener('error', function(msg1, msg2) { console.log('ERR: ' + msg1 + ' ' + msg2 ) } )</code></pre>
</div>


<p>Now we emit the error event,</p>

<div>
  <pre><code class='javascript'>emitter.emit('error', 'Bug detected', '@ Step 4')</code></pre>
</div>


<p>Once the &lsquo;error&rsquo; event is emitted, the listener performs the callback and we see the error logged in the console(as we have written in the callback function)
<code>ERR: Bug detected @ Step 4</code></p>

<p>We could add listeners on any more custom events and handle them when the event is emitted.</p>

<p>Now that we have got to know how events are emitted and handled via listeners, lets try out a small server that listens for requests and processes them.</p>

<div>
  <pre><code class='javascript'>var http = require('http'),
    sys = require('sys');

var server = http.createServer(function(request, response) {
  request.on('data', function (chunk) { console.log(chunk.toString()); });

  request.on('end', function() {
    response.write('Request Completed!');
    response.end();
  });

});

console.log(&quot;Starting up the server&quot;);
server.listen(8000);</code></pre>
</div>


<p>Here, <code>http.createServer</code> method returns an object which inherits from the EventEmitter constructor.</p>

<p>Check out the <a href="http://nodejs.org/api/http.html#http_http_createserver_requestlistener">nodejs api doc</a> for the createServer method in the<strong> http.js</strong> module,</p>

<p><code>http.createServer([requestListener]),Â </code><em>It says that requestListener is a function which is automatically added to the &lsquo;request&rsquo; event.</em></p>

<p>To check whats going on behind the scenes here, lets dive into the code base of nodejs,
As can be seen from code, the createServer method is within the http.js module. Inspecting the <strong>http.js</strong> module,</p>

<div>
  <pre><code class='javascript'>exports.createServer = function(requestListener) {
  return new Server(requestListener);
};</code></pre>
</div>


<p>Check for the <strong>_http_server.js</strong> module to find the <code>Server</code> constructor which has the following lines of code,</p>

<div>
  <pre><code class='javascript'>if (requestListener) {
  this.addListener('request', requestListener); // event listener for the server
}</code></pre>
</div>


<p>As per the above snippet, &lsquo;<strong>this</strong>&rsquo;(the current server instance ) listens for the &lsquo;request&rsquo; event and attaches the requestListener function to be performed when the event is emitted.</p>

<p>Here,</p>

<div>
  <pre><code class='javascript'>function(request, response) {
  request.on('data', function (chunk) { console.log(chunk.toString()); });

  request.on('end', function() {
    response.write('Request Completed!');
    response.end();
  });
}</code></pre>
</div>


<p><em>is our requestListener.</em></p>

<p>Now, further inspecting the <strong>_http_server.js </strong>module<strong>,Â </strong>we could also see how the request event is emitted,</p>

<div>
  <pre><code class='javascript'>self.emit('request', req, res); // event emitter for the server</code></pre>
</div>


<p><em>&lsquo;req&rsquo; and &lsquo;res&rsquo; are the request, response objects that are passed as arguments to the requestListener function called when the &lsquo;request&rsquo; event is emitted. Here self is &lsquo;this&rsquo; ( our current server instance)</em>.</p>

<p>We could well make the server listen for the request event on our own. For this,</p>

<div>
  <pre><code class='javascript'>var server = http.createServer()
server.on('request', function(request, response) {
  request.on('data', function (chunk) { console.log(chunk.toString()); });

  request.on('end', function() {
    response.write('Request Completed!');
    response.end();
  })
});</code></pre>
</div>


<p>Here when we create the server instance, we do not pass the requestListener( <em>Do notice that requestListener was only optional in http.createServer([requestListener])Â </em>). Instead we attach a listener of our own on the server which listens to the &lsquo;request&rsquo; event and performs the callback function when the request event is emitted, i.e,</p>

<div>
  <pre><code class='javascript'>server.on('request', function(request, response) { ... });</code></pre>
</div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/07/06/rails-admin-with-authlogic">Rails Admin With Authlogic</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-06T23:13:31+05:30" pubdate data-updated="true">Jul 6<span>th</span>, 2013</time>
        
         | <a href="/2013/07/06/rails-admin-with-authlogic#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you have used the rails_admin gem, you would have noticed that its tightly coupled with Devise. What happens if devise is not the pick and the application is already integrated with authlogic. Lets see,</p>

<p>After installing the rails_admin gem, create a &lsquo;<strong>rails_admin.rb</strong>&rsquo; file in <strong>config/initializers</strong>. Paste the following code,</p>

<div>
  <pre><code class='ruby'>RailsAdmin.config do |config|
    config.authorize_with do
      redirect_to root_path, :alert =&gt; &quot;You are not authorized!&quot; unless current_user.admin?
    end
  end

  RailsAdmin.config do |config|
    config.authenticate_with do
      unless current_user
        redirect_to login_url
      end
    end
  end</code></pre>
</div>


<p>The authentication block checks if the user is currently logged in and the authorization block checks if the logged in user is an admin or not.</p>

<p>Also add the rails admin route in the <strong>config/routes.rb</strong> file.</p>

<div>
  <pre><code class='ruby'>mount RailsAdmin::Engine =&gt; '/admin', :as =&gt; 'rails_admin'</code></pre>
</div>


<p>This should enable the admin to run at /admin, now authenticated and authorized using authlogic.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/28/prototypal-inheritance-in-javascript">Prototypal Inheritance in Javascript</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-28T14:36:11+05:30" pubdate data-updated="true">Jun 28<span>th</span>, 2013</time>
        
         | <a href="/2013/06/28/prototypal-inheritance-in-javascript#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I decided to get my hands on Javascript, the biggest road block for me was to understand and follow the prototypal inheritance model in Javascript. Coming from a Ruby background, the inheritance model I learned and understood was the classical one. The prototypal model had fundamental differences and did run me nuts at times. Here I try to make some note of what its all about going along a few snippets.</p>

<p><strong>What exactly is a prototype?</strong>
As explained in &lsquo;Javascript: The Definitive Guide&rsquo; &ndash; An objectâ€™s prototype is a reference to another object from which properties are inherited. Every JavaScript object has a second JavaScript object (or null, but this is rare) associated with it. This second object is known as a prototype, and the first object inherits properties from the prototype.</p>

<p>In Javascript, an object can be created with object literals, with the new keyword, and (in ECMAScript 5) with the Object.create() function</p>

<ol>
<li><p> obj = { } Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â //object literals, objects created will have Object.prototype as their prototype</p></li>
<li><p> obj = Object.create(args, [args2]) Â  Â  Â  Â //Object.create(), Objects created like this will have the first argument to the create method as their prototype</p></li>
<li><p> obj = new Constructor invocation Â  Â  //new Keyword, objects created this way will have the value of the prototype property of the constructor function as their prototype</p></li>
</ol>


<p><strong>Object.prototype</strong>: Its one of those rare objects which do not have a prototype, and hence is not associated with any other object.</p>

<p>Lets try and study the prototype of objects created via each of these 3 ways.
1) <strong>object literals</strong>,Â <strong>{ }</strong></p>

<div>
  <pre><code class='javascript'>obj = { }</code></pre>
</div>


<p>obj will have always Object.prototype as its prototype. Inspecting obj in your console, and you will find this.</p>

<p><a href="http://sunilkumarn.files.wordpress.com/2013/06/prototype11.png"><img src="http://sunilkumarn.files.wordpress.com/2013/06/prototype11.png?w=570" alt="Prototype1" /></a></p>

<p><strong><strong>proto</strong></strong> is the prototype object ( Object.prototype) from which obj inherits the properties.</p>

<p>You can always use Object.getPrototypeOf to check the prototype of an object. The below screenshot shows the prototype object of obj.</p>

<p><a href="http://sunilkumarn.files.wordpress.com/2013/06/prototype2.png"><img src="http://sunilkumarn.files.wordpress.com/2013/06/prototype2.png?w=570" alt="prototype2" /></a></p>

<p>2)<strong> Object.create()</strong></p>

<div>
  <pre><code class='javascript'>obj = Object.create(Object.prototype)</code></pre>
</div>


<p>Doing this is exactly the same as creating an object with literals( obj = { }). This is because the first argument to the create method forms the prototype of the newly created object, obj. In our statement we have specified Object.prototype as the first argument to be used. Also note that Object.create also takes a second optional argument which defines the properties of the object.</p>

<p>We could specify an object or null as the first argument to the create method. If we pass null as the first argument to create, then the newly created object won&rsquo;t inherit any property.</p>

<div>
  <pre><code class='javascript'>Mammal = Object.create(null, {knownTime: { value: 'infinity' }} )</code></pre>
</div>


<p>We have an object Mammal with no inherited properties. It has a property of its own, (knownTime with a value set to &lsquo;infinity&rsquo;).</p>

<div>
  <pre><code class='javascript'>Man = Object.create(Mammal)</code></pre>
</div>


<p>Object.getPrototypeOf(Man) will return an object with a single property, knownTime. Also,</p>

<div>
  <pre><code class='javascript'>Man.knownTime
   -&gt; 'infinity'</code></pre>
</div>


<p>Now create another object inheriting from &lsquo;Man&rsquo;</p>

<div>
  <pre><code class='javascript'>John = Object.create(Man)
John.knownTime
   -&gt; 'infinity'</code></pre>
</div>


<p>Now, lets fiddle around these objects.
Try adding new properties to these objects.</p>

<p>Set a max height of Mammals.</p>

<div>
  <pre><code class='javascript'>Mammal.maxHeight = '200'</code></pre>
</div>




<div>
  <pre><code class='javascript'>Man.maxHeight
   -&gt; '200'
John.maxHeight
   -&gt; '200'</code></pre>
</div>


<p>Set a nice rhythmic vocal for mammals.</p>

<div>
  <pre><code class='javascript'>Mammal.sound = function() { return( &quot;Wholaa!&quot; ) }</code></pre>
</div>




<div>
  <pre><code class='javascript'>Mammal.sound()
  -&gt; &quot;Wholaa!&quot;
Man.sound()
  -&gt; &quot;Wholaa!&quot;
John.sound()
  -&gt; &quot;Wholaa!&quot;</code></pre>
</div>


<p>Sure, Man has a different kind of a pitch from the other mammals.</p>

<div>
  <pre><code class='javascript'>Man.sound = function() { return( &quot;Cheerpp!&quot; )}</code></pre>
</div>




<div>
  <pre><code class='javascript'>Man.sound()
   -&gt; &quot;Cheerpp!&quot;
John.sound()
   -&gt; &quot;Cheerpp!&quot;</code></pre>
</div>


<p>Object.getPrototypeOf(John) returns an object(Man &ndash; with a property &lsquo;sound&rsquo;) which has another object(Mammal &ndash; with properties &lsquo;knownTime, maxHeight and sound&rsquo;) as its prototype.</p>

<p><a href="http://sunilkumarn.files.wordpress.com/2013/06/prototype3.png"><img src="http://sunilkumarn.files.wordpress.com/2013/06/prototype3.png" alt="prototype3" /></a></p>

<p>The prototype chain looks as follows</p>

<p><a href="http://sunilkumarn.files.wordpress.com/2013/06/prototype_chain4-new-page.png"><img src="http://sunilkumarn.files.wordpress.com/2013/06/prototype_chain4-new-page.png?w=570" alt="Prototype_Chain4 - New Page" /></a></p>

<p>ObjectÂ <strong>Mammal</strong>Â has properties &lsquo;knownTime&rsquo;, &lsquo;maxHeight&rsquo; and and the method &lsquo;sound&rsquo;. Â <strong>Man</strong>Â hasÂ Mammal as its prototype object and hence inheritsÂ theseÂ properties from Mammal. Â However, it overrides the &lsquo;sound&rsquo; method.Â <strong>JohnÂ </strong>has Man as its prototype object and hence inherits properties from Man(which includes Man&rsquo;s own properties and properties inherited from Mammal).</p>

<p>3) <strong>new keyword followed by a Constructor Invocation</strong></p>

<p>Try this,</p>

<div>
  <pre><code class='javascript'>obj = new Object()</code></pre>
</div>


<p>Here again, this is exactly the same as Object.create(Object.prototype) and {}. The prototype of the object, obj is Object.prototype.</p>

<p>Here, Object is the constructor which when invoked using the new keyword will return a new object which inherits properties from the prototype of the constructor (here, Object.prototype).</p>

<p><strong>Constructor</strong>(as per the Definitive Guide): A constructor is a function designed for the initialization of newly created objects. Constructors are invoked using the new keyword. Constructor invocations using new automatically create the new object, so the constructor itself only needs to initialize the state of that new object. The critical feature of constructor invocations is that the prototype property of the constructor is used as the prototype of the new object.</p>

<p>Also, note that every JavaScript function (except functions returned by the EC-MAScript 5 Function.bind() method) automatically has a prototype property. Hence, a constructor being merely a function also has the prototype property.
To make this more sense, lets create a constructor and try and figure out what exactly happens.</p>

<div>
  <pre><code class='javascript'>function Startup(config) {
   this.config = config ;
   this.motto = function(verbiage) {
      return(&quot;Our motto is&quot; + verbiage)
    }
 }</code></pre>
</div>


<p>Now, create a new instance</p>

<div>
  <pre><code class='javascript'>s1 = new Startup(true)</code></pre>
</div>


<p>s1 is an object with Startup.prototype as its prototype, and hence inherits properties from Startup.prototype</p>

<div>
  <pre><code class='javascript'>s1.config
  -&gt; true
s1.motto(&quot;we change&quot;)
  -&gt; &quot;Our motto is we change&quot;</code></pre>
</div>


<p>Create another instance,</p>

<div>
  <pre><code class='javascript'>s2 = new Startup(false)</code></pre>
</div>


<p>s2 is an object with Startup.prototype as its prototype, and hence inherits properties from Startup.prototype</p>

<div>
  <pre><code class='javascript'>s2.config
  -&gt; false
s2.motto(&quot;we build&quot;)
  -&gt; &quot;Our motto is we build!&quot;</code></pre>
</div>


<p>Now, we did like a bit more functionality to be achieved by all objects instantiated from Startup. For that to happen, we need to add more properties to Startup.prototype</p>

<div>
  <pre><code class='javascript'>Startup.prototype.space = function(people) { return(people/ 5) }
Startup.prototype.stream = function() {
   if(this.config == true)
       return(&quot;service&quot;) ;
   else
       return(&quot;business&quot;);
 }</code></pre>
</div>


<p>Now, you could use these properties on the instances,</p>

<div>
  <pre><code class='javascript'>s1.space(25)
   -&gt; 5
s1.stream()
   -&gt; &quot;service&quot;

s2.space(40)
   -&gt; 8
s2.stream()
   -&gt; &quot;business&quot;</code></pre>
</div>


<p><a href="http://sunilkumarn.files.wordpress.com/2013/06/prototoype_5-new-page-11.png"><img src="http://sunilkumarn.files.wordpress.com/2013/06/prototoype_5-new-page-11.png?w=570" alt="Prototoype_5 - New Page (1)" /></a></p>

<p>As is clear from the image above, we have 4 objects here, the constructor object(Startup) with its property(prototype), the prototype object (Startup.prototype) with all its properties and the instances(s1 &amp; s2).<a href="http://sunilkumarn.files.wordpress.com/2013/06/prototoype_5-new-page.png">
</a></p>

<p>Now suppose we alter the prototype property of Startup</p>

<div>
  <pre><code class='javascript'>Startup.prototype = { stream : function() {return(&quot;No more a startup&quot;) }}</code></pre>
</div>


<p>As is quite evident,</p>

<div>
  <pre><code class='javascript'>s1.stream()
   -&gt; &quot;No more a startup!&quot;
s2.stream()
   -&gt; &quot;No more a startup!&quot;</code></pre>
</div>


<p>On this account, it might be clear on how to add new methods to be used by arrays, dates and other such objects created via a Constructor Invocation. With <em>Array being the constructor function and Array.prototype being the prototype of all objects instantiated via the Array Constructor invocation</em>,</p>

<p>A clone on all arrays,</p>

<div>
  <pre><code class='javascript'>Array.prototype.clone = function() {
   return this.concat()
   }

[1,2,3].clone()
   -&gt; [1,2,3]</code></pre>
</div>


<p>Clear off the array,</p>

<div>
  <pre><code class='javascript'>Array.prototype.clear = function() {
    this.length = 0 ;
    return this ;
   }

[1,2,3].clear()
    -&gt; []</code></pre>
</div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/23/node-js-streams-and-pipes">Node.js: Streams and Pipes.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-23T00:27:26+05:30" pubdate data-updated="true">Jun 23<span>rd</span>, 2013</time>
        
         | <a href="/2013/06/23/node-js-streams-and-pipes#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Node.js is used for building a lot of network applications and there&rsquo;s a lot of data being passed around. This could well be huge in size. In node, all this data is processed the moment its received, piece by piece. This is done with the help of streams. Here we discuss the usage of streams by writing a small node script that handles file upload.</p>

<p>Here&rsquo;s the actual piece of code that handles a file upload and responds back to the client with the progress of the upload.</p>

<div>
  <pre><code class='javascript'>var http = require('http'),
  sys = require('sys'),
  fs = require('fs');

  var server = http.createServer();
  console.log(&quot;Starting up the server&quot;);
  server.listen(8000);

  server.on('request', function(request, response) {
    var file = fs.createWriteStream('copy.csv');
    var fileSize = request.headers['content-length'];
    var uploadedSize = 0;

    request.on('data', function (chunk) {
      uploadedSize += chunk.length;
      uploadProgress = (uploadedSize/fileSize) * 100;
      response.write(Math.round(uploadProgress) + &quot;%&quot; + &quot; uploaded\n&quot; );
      var bufferStore = file.write(chunk);
      if(bufferStore == false)
        request.pause();
    });

    file.on('drain', function() {
      request.resume();
    })

    request.on('end', function() {
      response.write('Upload done!');
      response.end();
    })

  });</code></pre>
</div>


<p>The basics: We create a node server that listens on port 8000. Upon receival of a request, we create a write stream ( the destination file path ). Each chunk of data received is written on to the destination path, the upload progress is calculated and responded back.</p>

<p>Lets break up the above snippet into pieces and make an analysis of whats happening.</p>

<p>A writeStream is created and &lsquo;copy.csv&rsquo; is the destination path to which the received data will be written.</p>

<div>
  <pre><code class='javascript'>var file = fs.createWriteStream('copy.csv');</code></pre>
</div>


<p>The following piece forms the core of the upload process.</p>

<div>
  <pre><code class='javascript'>request.on('data', function (chunk) {
    var bufferStore = file.write(chunk);
    if(bufferStore == false)
      request.pause();
    uploadedSize += chunk.length;
    uploadProgress = (uploadedSize/fileSize) * 100;
    response.write(Math.round(uploadProgress) + &quot;%&quot; + &quot; uploaded\n&quot; );
  });

  file.on('drain', function() {
    request.resume();
  })</code></pre>
</div>


<p>Looking at the code &ndash; on receiving each chunk of data ( via the read stream ), its written to the write stream as
<code>file.write(chunk);</code></p>

<p>Right now, we need to pause a bit to check whether there might be a cause of worry in this whole read-write streaming process. The answer is yes, and is very obvious. <strong>There exists a real possibility that the rate at which the data is written to the writeStream is less than the rate at which its read from the readStream</strong>. This is a genuine cause of concern and hence cannot be ignored. How we handle this forms our next two lines of code.</p>

<p><code>file.write(chunk)</code> stores the data onto a buffer. It returns true if the write was performed and returns false if the write failed due to the buffer being full. So, we need to handle this by pausing the readStream if the buffer storage is full.</p>

<div>
  <pre><code class='javascript'>var bufferStore = file.write(chunk);
  if(bufferStore == false)
    request.pause();</code></pre>
</div>


<p>Also, we need to re-start streaming data from the read stream once the buffer is drained out. The following lines of code does just that.</p>

<div>
  <pre><code class='javascript'>file.on('drain', function() {
    request.resume();
  })</code></pre>
</div>


<p><strong>Pipes in node</strong>: Here, we have handled the logic of keeping the read &ndash; write rate to be in sync. Node.js provides us with pipes which has this logic already encapsulated in it.</p>

<p>The following line,</p>

<div>
  <pre><code class='javascript'>request.pipe(file) // The notion is quite similar to UNIX pipes. Pipes the input into an output stream.</code></pre>
</div>


<p>would be equivalent to</p>

<div>
  <pre><code class='javascript'>request.on('data', function(chunk) {
    var bufferStore = file.write(chunk);
    if(bufferStore == false)
      request.pause();
  })

  file.on('drain', function() {
    request.resume();
  })</code></pre>
</div>


<p>Pipe by itself maintains the read write rate to be in sync by pausing and resuming when necessary.</p>

<p>Now since we have handled our cause of concern, all that is left is to calculate the upload percentage upon receiving each chunk of data and respond back with the calculated percentage.</p>

<div>
  <pre><code class='javascript'>uploadedSize += chunk.length;
  uploadProgress = (uploadedSize/fileSize) * 100;
  response.write(Math.round(uploadProgress) + &quot;%&quot; + &quot; uploaded\n&quot; );</code></pre>
</div>


<p>Do note that the actual size of the upload file is calculated from the request headers.</p>

<div>
  <pre><code class='javascript'>var fileSize = request.headers['content-length'];</code></pre>
</div>


<p>Now, when the request ends ( i.e the &lsquo;end&rsquo; event is emitted by the request ), the final chunk of response is given back to the client indicating that our file upload has been done successfully.</p>

<p>To test this, run the node server and try making a request, something like this:</p>

<p><code>curl -v --upload-file "upload_file.csv" "http://localhost:8000"</code></p>

<p>and the upload progress could be tracked.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/21/mercury-the-wysiwyg-html-editor">Mercury: The WYSIWYG Html Editor</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-21T00:53:48+05:30" pubdate data-updated="true">May 21<span>st</span>, 2013</time>
        
         | <a href="/2013/05/21/mercury-the-wysiwyg-html-editor#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had this application where different users would want to edit custom html pages to be shown up in there web sites. Each user will have his own domain( all domains pointing to the same Rails application ) and the custom html page had to be loaded as per the current domain. To do this, in search of a WYSIWYG html editor which is easy to setup and simple to start off, I ended up in <a href="http://jejacks0n.github.io/mercury/">Mercury</a>. Whats really nice was that Mercury also had a <a href="https://github.com/balupton/mercury-rails">gem</a> to be used for Rails developer and as I am one, I had no more hesitation in get started with mercury.</p>

<p>To get started off with mercury, add</p>

<div>
  <pre><code class='ruby'>gem 'mercury-rails'</code></pre>
</div>


<p>to the Gemfile and bundle it.</p>

<p>Run the rails generator for the mercury files.</p>

<div>
  <pre><code class='ruby'>rails g mercury:install</code></pre>
</div>


<p>A couple of questions will be posted. Press &lsquo;yes&rsquo; to install the layout files.</p>

<p>Now checking out the directory structure, Â you could see three additional files.</p>

<p><strong>mercury.js</strong> and<strong> mercury.css</strong> in the js and stylesheets assets respectively. Also, a new layout file for the mercury editor, <strong>mercury.html.erbÂ </strong></p>

<p>I did remove the mercury css file later on.</p>

<p>One thing that needs to be noticed here is that the mercury.js file is heavy and it woudn&rsquo;t be a good idea to load it in all the pages. We would want to load it in only the pages that needs to be edited. Checkout the mercury layout file and you can see that the mercury.js file is included.</p>

<div>
  <pre><code class='ruby'>&lt;head&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, maximum-scale=1.0, initial-scale=1.0&quot;&gt;
        &lt;%= csrf_meta_tags %&gt;
        &lt;title&gt;Mercury Editor&lt;/title&gt;
        &lt;%= stylesheet_link_tag 'mercury' %&gt;
        &lt;%= javascript_include_tag 'jquery-1.7', 'mercury' %&gt;
    &lt;/head&gt;</code></pre>
</div>


<p>Now to prevent mercury.js from being loaded up in the pages, we could move all the other js files in our application to a separete directory and then require the directory in our application.js</p>

<p>My application.js will have,</p>

<div>
  <pre><code class='ruby'>//= require_tree ./main</code></pre>
</div>


<p>where main is the directory which has all the application specific javascript. (Probably could be a better name :) )</p>

<p>Now peep into the routes file, you could see this extra line,</p>

<div>
  <pre><code class='ruby'>mount Mercury::Engine =&gt; '/'</code></pre>
</div>


<p>What this line does is that it allows the html pages in your application to be edited. An extra &lsquo;/editor&rsquo; Â will have to be added at the beginning of each url path to load the mercury editor for the page.</p>

<p>Consider you have the url &lsquo;<strong>localhost:3000/pages</strong>&rsquo; , all you need to load it in the mercury layout is to change it to &lsquo;<strong>&#8216;localhost:3000/editor/pages</strong>&rsquo; . You have mercury loaded up to edit your page and can now see it in the mercury editor&rsquo;s layout.</p>

<p><a href="http://sunilkumarn.files.wordpress.com/2013/05/screenshot.png"><img src="http://sunilkumarn.files.wordpress.com/2013/05/screenshot.png?w=570" alt="Screenshot" /></a></p>

<p>However this isn&rsquo;t just enough to start editing the page. You need to specify editable regions in the page.
InÂ <code>pages.html.erbÂ </code></p>

<div>
  <pre><code class='ruby'>&lt;div class=&quot;control-group&quot;&gt;
        &lt;h3 class=&quot;section_header page-header&quot;&gt;Pricing page&lt;/h3&gt;
        &lt;div id=&quot;faq&quot; class=&quot;mercury-region&quot; data-type=&quot;editable&quot; data-mercury=&quot;full&quot;&gt;
            &lt;%= render :file =&gt; file_path(@domain 'faq') %&gt;
        &lt;/div&gt;
    &lt;/div&gt;</code></pre>
</div>


<p>Consider this piece of code. A div with id=&ldquo;faq&rdquo; is made editable with<strong>Â class=&ldquo;mercury-region&rdquo; </strong>and attributes<strong> data-type=&ldquo;editable&rdquo; </strong>and<strong> data-mercury=&ldquo;full&rdquo;</strong>.</p>

<p>Now you can see the editable region.</p>

<p><a href="http://sunilkumarn.files.wordpress.com/2013/05/screenshot-1.png"><img src="http://sunilkumarn.files.wordpress.com/2013/05/screenshot-1.png?w=570" alt="Screenshot-1" /></a></p>

<p>This following line in above piece of code</p>

<div>
  <pre><code class='ruby'>&lt;%= render :file =&gt; file_path(@domain, 'faq') %&gt;</code></pre>
</div>


<p>invokes a helper method and loads the already created sample faq template which can now be edited and saved for the particular domain. As simple as that.</p>

<p>Similarly you could edit more pages here. This is how the contacts page can be edited.</p>

<div>
  <pre><code class='ruby'>&lt;div class=&quot;control-group&quot;&gt;
        &lt;h3 class=&quot;section_header page-header&quot;&gt;Contact page&lt;/h3&gt;
        &lt;div id=&quot;contact&quot; class=&quot;mercury-region&quot; data-type=&quot;editable&quot; data-mercury=&quot;full&quot;&gt;
            &lt;%= render :file =&gt; file_path(@domain, 'contact') %&gt;
        &lt;/div&gt;
    &lt;/div&gt;</code></pre>
</div>


<p>Also, you probably might want to change the save url of the mercury editor for the particular page. That is the controller action to which the mercury edited contents will be &lsquo;POST&rsquo; or &lsquo;PUT&rsquo; (depends on the configuration set in the mercury.html.erb)</p>

<p>To change the mercury save url for this particular page, I wrote the script in the erb file ( pages.html.erb )</p>

<div>
  <pre><code class='ruby'>&lt;script&gt;
        $(window).on('mercury:ready', function () {
            Mercury.saveUrl = &quot;&lt;%= pages_upload_admin_domain_path(@domain) %&gt;&quot;;
        });
    &lt;/script&gt;</code></pre>
</div>


<p>You might also want to change the page thats to be redirected to once we are done with editing using mercury. We could bind on mercury&rsquo;s save event to get this done.</p>

<div>
  <pre><code class='ruby'>$(window).bind('mercury:saved', function() {
        $(window.location.replace('/admin/domain'));
    });</code></pre>
</div>


<p>All this saved data would have to be dealt with in the controller action. Inspecting the params in the controller action ( the mercury Save url) ,</p>

<pre><code>&lt;code&gt;{"content"=&gt;
    {"faq"=&gt;
        {"type"=&gt;"full",
         "data"=&gt;{},
         "value"=&gt; "&lt;h1&gt;This is where I have done my FAQ editing&lt;/h1&gt;"
         "snippets" =&gt; {}
        }     
    },

    {"contact"=&gt;
        {"type"=&gt;"full",
         "data"=&gt;{},
         "value"=&gt; "&lt;h1&gt;This is where I have done my Contacts editing&lt;/h1&gt;"
         "snippets" =&gt; {}
        }
    }
}

&lt;/code&gt;
</code></pre>

<p>There are two things of notice here. The contents hash contains all the mercury related stuff. Â Each hash in the contents hash has a key which is equal to the id of the mercury editable html divisions ( see the view code pasted above ), here &lsquo;<strong>faq</strong>&rsquo; and &lsquo;<strong>contact</strong>&rsquo;. The actual edited html content can be found in the hash with key &lsquo;value&rsquo; (Â <strong><h1>This is where I have done my Contacts editing</h1></strong>). Â &#8217;The controller action could decide on how to save this html content.</p>

<p><em>What have I done to solve my case mentioned at the starting?</em></p>

<p><em><em>I created a pages directory in my public. Within the pages directory I created sub directories which corresponds to the domain. </em><strong>For eg, the domain localhost corresponds to the directory named localhost inside the public/pages directory and the domain remotehost corresponds to the remotehost directory</strong></em>.</p>

<p>I then saved all these edited html content as html files within these domain specific directories. When a particular domain was loaded, the html pages ( for eg, faq and contact) was rendered from the corresponding domain directories in the public folder .</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014/02/27/objective-c-categories-into-rubymotion">Objective-C Categories Into Rubymotion</a>
      </li>
    
      <li class="post">
        <a href="/2014/02/06/rubymotion-chain-of-modal-segues">Rubymotion: Chain of Modal Segues</a>
      </li>
    
      <li class="post">
        <a href="/2014/01/24/rubymotion-using-progresshud-while-making-http-calls">Rubymotion: Using ProgressHud While Making Http Calls</a>
      </li>
    
      <li class="post">
        <a href="/2013/12/18/heroku-deployment-with-mongodb-database">Heroku Deployment With MongoDB Database</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/01/migrating-from-wordpress-to-jekyll-in-ten-steps">Migrating From Wordpress to Jekyll in Ten Steps</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/07/node-js-event-emitters-and-listeners">Node.js: Event Emitters and Listeners</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/06/rails-admin-with-authlogic">Rails Admin With Authlogic</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/28/prototypal-inheritance-in-javascript">Prototypal Inheritance in Javascript</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/23/node-js-streams-and-pipes">Node.js: Streams and Pipes.</a>
      </li>
    
      <li class="post">
        <a href="/2013/05/21/mercury-the-wysiwyg-html-editor">Mercury: The WYSIWYG Html Editor</a>
      </li>
    
  </ul>
</section>




<section class="googleplus">

<h1>
  <a href="http://github.com/sunilkumarn/"><img src="http://i835.photobucket.com/albums/zz277/sunilkumargec56/github_zpse87fc53d.jpg" width="40" height="40"></a>
  &nbsp; &nbsp;
  <a href="http://twitter.com/sunilkumar_g56"><img src="http://i835.photobucket.com/albums/zz277/sunilkumargec56/twitter_zps447bd274.jpg" width="40" height="40"></a>
</h1>

</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Sunil Kumar -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'techscribblings';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44991607-1', 'sunilnkumar.com');
    ga('send', 'pageview');
  </script>
</body>

</html>
